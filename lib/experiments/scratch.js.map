{
  "version": 3,
  "file": "",
  "sourceRoot": "",
  "sources": [
    "../../src/experiments/scratch.coffee"
  ],
  "names": [],
  "mappings": "AACA;EAAA;AAAA,MAAA,CAAA,EAAA,qBAAA,EAAA,MAAA,EAAA,aAAA,EAAA,MAAA,EAAA,wBAAA,EAAA,KAAA,EAAA,MAAA,EAAA,GAAA,EAAA,QAAA,EAAA,KAAA,EAAA,IAAA,EAAA,EAAA,EAAA,IAAA,EAAA,SAAA,EAAA,SAAA,EAAA,IAAA,EAAA,EAAA,EAAA,EAAA,EAAA,SAAA,EAAA,KAAA,EAAA,KAAA,EAAA,MAAA,EAAA,KAAA,EAAA,IAAA,EAAA,KAAA,EAAA,IAAA,EAAA,MAAA,EAAA,IAAA,EAAA,IAAA,EAAA,GAAA,EAAA,SAAA,EAAA,EAAA,EAAA,IAAA,EAAA,SAAA,EAAA,QAAA,EAAA,4BAAA,EAAA,GAAA,EAAA,MAAA,EAAA,KAAA,EAAA,KAAA,EAAA,OAAA,EAAA,KAAA,EAAA,IAAA,EAAA,QAAA,EAAA,IAAA,EAAA,OAAA;;;EAIA,GAAA,GAA4B,OAAA,CAAQ,KAAR;;EAC5B,GAAA,GAA4B,GAAG,CAAC;;EAChC,KAAA,GAA4B;;EAC5B,KAAA,GAA4B,GAAG,CAAC,UAAJ,CAAe,OAAf,EAA4B,KAA5B;;EAC5B,KAAA,GAA4B,GAAG,CAAC,UAAJ,CAAe,OAAf,EAA4B,KAA5B;;EAC5B,OAAA,GAA4B,GAAG,CAAC,UAAJ,CAAe,SAAf,EAA4B,KAA5B;;EAC5B,IAAA,GAA4B,GAAG,CAAC,UAAJ,CAAe,MAAf,EAA4B,KAA5B;;EAC5B,IAAA,GAA4B,GAAG,CAAC,UAAJ,CAAe,MAAf,EAA4B,KAA5B;;EAC5B,IAAA,GAA4B,GAAG,CAAC,UAAJ,CAAe,MAAf,EAA4B,KAA5B;;EAC5B,IAAA,GAA4B,GAAG,CAAC,UAAJ,CAAe,MAAf,EAA4B,KAA5B;;EAC5B,IAAA,GAA4B,GAAG,CAAC,IAAI,CAAC,IAAT,CAAc,GAAd;;EAC5B,IAAA,GAA4B,OAAA,CAAQ,MAAR;;EAC5B,EAAA,GAA4B,OAAA,CAAQ,IAAR;;EAC5B,CAAA,CAAE,EAAF,CAAA,GAA4B,GAA5B;;EACA,MAAA,GAA4B,MAAM,CAAC;;EACnC,SAAA,GAA4B,QAAA,CAAA,GAAE,CAAF,CAAA;WAAY,IAAI,CAAC,OAAL,CAAa,IAAI,CAAC,IAAL,CAAU,GAAA,CAAV,CAAb;EAAZ,EAnB5B;;;EAqBA,KAAA,GAA4B,OAAA,CAAQ,UAAR;;EAC5B,CAAA,CAAE,GAAF,EACE,QADF,EAEE,IAFF,EAGE,OAHF,CAAA,GAG4B,KAH5B,EAtBA;;;;EA4BA,KAAA,GAA4B,OAAA,CAAQ,OAAR;;EAC5B,CAAA,CAAE,SAAF,EACE,KADF,EAEE,IAFF,EAGE,MAHF,EAIE,MAJF,CAAA,GAI4B,KAAK,CAAC,MAAN,CAAA,CAJ5B,EA7BA;;;EAmCA,EAAA,GAA4B,OAAA,CAAQ,YAAR,EAnC5B;;;EAqCA,CAAA,CAAE,CAAF,EACE,MADF,EAEE,MAFF,EAGE,MAHF,EAIE,aAJF,EAKE,wBALF,EAME,KANF,CAAA,GAM4B,EAAE,CAAC,MAAH,CAAA,CAN5B,EArCA;;;EA6CA,KAAA,GAA4B,QAAA,CAAE,GAAF,EAAO,CAAP,CAAA;WAAc,UAAA,CAAW,CAAX,EAAc,GAAA,GAAM,IAApB;EAAd;;EAC5B,KAAA,GAA4B,QAAA,CAAE,GAAF,CAAA;WAAW,IAAI,OAAJ,CAAY,QAAA,CAAE,IAAF,CAAA;aAAY,KAAA,CAAM,GAAN,EAAW,IAAX;IAAZ,CAAZ;EAAX,EA9C5B;;;;EAiDA,SAAA,GAA4B,OAAA,CAAQ,WAAR;;EAC5B,CAAA,CAAE,IAAF,CAAA,GAA4B,SAA5B,EAlDA;;;EAoDA,EAAA,GAA4B,OAAA,CAAQ,mBAAR;;EAC5B,QAAA,GAA4B,CAAA;;EAC5B,IAAA,GAA4B,CAAA;;EAC5B,SAAA,GAA4B,CAAA;;EAC5B,SAAA,GAA4B,KAAK,CAAC,MAAN,CAAa,OAAA,CAAQ,aAAR,CAAb;;EAE5B,QAAA,GAAW,QAAA,CAAA,GAAE,CAAF,CAAA;AAAW,QAAA;WAAC,IAAA,CAAK,GAAA;;AAAE;MAAA,KAAA,mCAAA;;qBAAA,GAAG,CAAC,IAAJ,CAAS,CAAT;MAAA,CAAA;;QAAF,CAAL;EAAZ,EA1DX;;;;;EA+DA,qBAAA,GAAwB,QAAA,CAAA,CAAA;AACtB,WAAO,CAAA,CAAE,QAAA,CAAE,CAAF,EAAK,IAAL,CAAA;MACP,QAAA,CAAS,MAAT,EAAiB,GAAA,CAAI,CAAJ,CAAjB;MACA,IAAG,CAAA,KAAK,gEAAR;QACE,IAAA,CAAK,MAAA,CAAO;UAAE,IAAA,EAAM;QAAR,CAAP,CAAL;QACA,IAAA,CAAK,MAAA,CAAO;UAAE,IAAA,EAAM,OAAR;UAAiB,IAAA,EAAM;QAAvB,CAAP,CAAL;eACA,IAAA,CAAK,MAAA,CAAO;UAAE,IAAA,EAAM;QAAR,CAAP,CAAL,EAHF;;IAFO,CAAF;EADe,EA/DxB;;;;;EA0EA,SAAS,CAAC,OAAV,GAAoB,QAAA,CAAE,IAAF,CAAA;IAClB,QAAQ,CAAC,IAAT,CAAc,IAAd;AACA,WAAO,CAAA,CAAE,QAAA,CAAE,CAAF,EAAK,IAAL,CAAA;MACP,IAAA,CAAQ,CAAE,GAAG,CAAC,IAAJ,CAAS,CAAT,CAAF,CAAH,GAAuB,CAAA,GAAI,IAA3B,GAAqC,CAA1C;AACA,aAAO;IAFA,CAAF;EAFW,EA1EpB;;;;;EAoFA,QAAQ,CAAC,iBAAT,GAA6B,QAAA,CAAA,CAAA;AAC7B,QAAA,WAAA,EAAA;IAAE,WAAA,GAAc;IACd,OAAA,GAAc;AACd,WAAO,CAAA,CAAE,CAAE,IAAF,EAAQ,IAAR,CAAA,GAAA;MACP,IAAU,WAAV;AAAA,eAAA;;MACA,OAAA;MACA,IAAG,cAAc,CAAC,IAAf,CAAoB,IAApB,CAAH;QACE,WAAA,GAAc;QACd,IAAA,CAAK,SAAA,CAAU,OAAV,EAAmB;UAAA,CAAA,EAAG,CAAE,OAAF;QAAH,CAAnB,CAAL;AACA,eAAO,IAAI,CAAC,GAAL,CAAA,EAHT;;aAIA,IAAA,CAAK,IAAL;IAPO,CAAF;EAHoB,EApF7B;;;;;EAoGA,IAAI,CAAC,sBAAL,GAA8B,QAAA,CAAA,CAAA;AAC9B,QAAA,OAAA,EAAA;IAAE,OAAA,GAAY;IACZ,QAAA,GAAY;AACZ,WAAO,CAAA,CAAE,CAAE,CAAF,EAAK,IAAL,CAAA,GAAA;MACP,IAAqB,OAAA,IAAW,CAAhC;AAAA,eAAO,IAAI,CAAC,GAAL,CAAA,EAAP;;AACA,cAAO,CAAC,CAAC,IAAT;AAAA,aACO,IADP;UAEI,QAAA,GAAW;UACX,IAAA,CAAK,CAAL;AAFG;AADP,aAIO,IAJP;UAKI,QAAA,GAAW;UACX,OAAA;UACA,IAAA,CAAK,CAAL;AAHG;AAJP;UASI,IAAiB,QAAjB;AAAA,mBAAO,IAAA,CAAK,CAAL,EAAP;;AATJ;AAUA,aAAO;IAZA,CAAF;EAHqB,EApG9B;;;EAsHA,IAAI,CAAC,YAAL,GAAoB,QAAA,CAAA,CAAA;AAClB,WAAO,CAAA,CAAE,CAAE,CAAF,EAAK,IAAL,CAAA,GAAA;MACP,KAAc,MAAA,CAAO,CAAP,EAAU,OAAV,CAAd;AAAA,eAAA;;aACA,IAAA,CAAK,CAAC,CAAC,IAAP;IAFO,CAAF;EADW,EAtHpB;;;;;;;;;;;;;EAsIA,IAAI,CAAC,SAAL,GAAiB,QAAA,CAAA,CAAA;AACjB,QAAA,SAAA,EAAA;IAAE,IAAA,GAAY,MAAA,CAAO,MAAP;IACZ,SAAA,GAAY;AACZ,WAAO,CAAA,CAAE,CAAE,IAAF,CAAF,EAAa,CAAE,CAAF,EAAK,IAAL,CAAA,GAAA;AACtB,UAAA;MAAI,IAAG,CAAA,KAAK,IAAR;QACE,IAAA,GAAO,SAAS,CAAC,IAAV,CAAe,EAAf;AACP,eAAO,IAAA,CAAK,SAAA,CAAU,aAAV,EAAyB,CAAE,IAAF,CAAzB,CAAL,EAFT;;MAGA,QAAQ,CAAC,IAAT,CAAc,CAAd;aACA,SAAS,CAAC,IAAV,CAAe,CAAf;IALkB,CAAb;EAHQ,EAtIjB;;;EAiJA,IAAI,CAAC,UAAL,GAAkB,QAAA,CAAA,CAAA;AAChB,WAAO,CAAA,CAAE,CAAE,CAAF,EAAK,IAAL,CAAA,GAAA;MACP,KAAqB,MAAA,CAAO,CAAP,EAAU,aAAV,CAArB;AAAA,eAAO,IAAA,CAAK,CAAL,EAAP;;aACA,IAAA,CAAK,IAAA,CAAK,CAAL,EAAQ,CAAE,CAAF,CAAA,GAAA;eAAS,CAAC,CAAC,IAAF,GAAS,SAAS,CAAC,IAAI,CAAC,SAAf,CAAyB,CAAC,CAAC,IAA3B;MAAlB,CAAR,CAAL;IAFO,CAAF;EADS,EAjJlB;;;EAuJA,IAAI,CAAC,SAAL,GAAiB,QAAA,CAAA,CAAA;AACf,WAAO,CAAA,CAAE,CAAE,CAAF,EAAK,IAAL,CAAA,GAAA;MACP,KAAqB,MAAA,CAAO,CAAP,EAAU,aAAV,CAArB;AAAA,eAAO,IAAA,CAAK,CAAL,EAAP;;MACA,IAAA,CAAK,KAAA,CAAM,CAAN,CAAL;aACA,IAAA,CAAK,SAAA,CAAU,QAAV,EAAoB,SAAS,CAAC,KAAK,CAAC,eAAhB,CAAgC,CAAC,CAAC,IAAlC,CAApB,CAAL;IAHO,CAAF;EADQ,EAvJjB;;;;;;;EAkKA,4BAAA,GAA+B,QAAA,CAAA,CAAA;AAE/B,QAAA,QAAA;;IACE,QAAA,GAAW,QAAA,CAAE,CAAF,EAAK,IAAL,EAAW,IAAX,CAAA,EAAA;;;;;;;;;;;MAWT,IAAA,CAAK,CAAL;aACA,IAAA,CAAA;IAZS,EADb;;IAgBE,IAAC,CAAA,OAAD,GAAW,QAAA,CAAE,CAAF,CAAA,EAAA;;AACb,UAAA,GAAA,EAAA,GAAA,EAAA;MACI,GAAA,GAAoB;MACpB,iBAAA,GAAoB;MACpB,GAAA,GAAoB;MACpB,GAAA,GAAoB,KAJxB;;AAMI,aAAO,wBAAA,CAAyB,KAAA,CAAE,IAAF,EAAQ,IAAR,CAAA,GAAA;QAC9B,QAAA,CAAS,MAAT,EAAiB,8BAAjB;QACA,IAAA,CAAK,SAAA,CAAU,2BAAV,CAAL;QACA,IAAA,CAAK,sBAAL;QACA,CAAC,CAAC,EAAF,GAAO,CAAA,MAAM,EAAE,CAAC,kBAAH,CAAsB,CAAE,GAAF,EAAO,iBAAP,EAA0B,GAA1B,CAAtB,CAAN;QACP,IAAA,CAAK,kBAAL,EAJN;;;QAOM,MAAM,CAAC,CAAC,EAAE,CAAC,IAAI,CAAC,cAAV,CAAyB,gBAAzB,EAA+C,CAAA,GAAE,CAAF,CAAA,GAAA;iBAAY,CAAE,OAAA,CAAQ,sBAAR,CAAF,CAAkC,CAAC,IAAnC,CAA4C,GAAA,CAA5C;QAAZ,CAA/C;QACN,MAAM,CAAC,CAAC,EAAE,CAAC,IAAI,CAAC,cAAV,CAAyB,mBAAzB,EAA+C,CAAA,GAAE,CAAF,CAAA,GAAA;iBAAY,CAAE,OAAA,CAAQ,sBAAR,CAAF,CAAkC,CAAC,OAAnC,CAA4C,GAAA,CAA5C;QAAZ,CAA/C;QACN,MAAM,CAAC,CAAC,EAAE,CAAC,IAAI,CAAC,QAAV,CAAmB,QAAA,CAAA,CAAA;iBACvB,CAAE,CAAA,CAAE,QAAF,CAAF,CAAc,CAAC,KAAf,CAAqB,MAAA,QAAA,CAAA,CAAA;YACnB,OAAO,CAAC,GAAR,CAAY,uBAAZ,EAAqC,kBAArC,EAAyD,CAAA,MAAM,cAAA,CAAA,CAAN,CAAzD;mBACA,OAAO,CAAC,GAAR,CAAY,uBAAZ,EAAqC,qBAArC,EAA4D,CAAA,MAAM,iBAAA,CAAA,CAAN,CAA5D;UAFmB,CAArB;QADuB,CAAnB;QAIN,KAAA,CAAM,uBAAN,EAA+B,SAA/B,EAA8C,CAAE,OAAA,CAAQ,sBAAR,CAAF,CAAkC,CAAC,IAAjF;QACA,KAAA,CAAM,uBAAN,EAA+B,YAA/B,EAA8C,CAAE,OAAA,CAAQ,sBAAR,CAAF,CAAkC,CAAC,OAAjF,EAdN;;QAgBM,IAAA,CAAK,SAAA,CAAU,0BAAV,CAAL;AACA,eAAO,IAAA,CAAA;MAlBuB,CAAzB;IAPE,EAhBb;;IA4CE,IAAC,CAAA,0BAAD,GAA8B,QAAA,CAAE,CAAF,CAAA;AAC5B,aAAO,MAAA,CAAO,KAAA,CAAE,CAAF,EAAK,IAAL,EAAW,IAAX,CAAA,GAAA;AAClB,YAAA,YAAA,EAAA,IAAA,EAAA;QAAM,KAAyC,MAAA,CAAO,CAAP,EAAU,0BAAV,CAAzC;AAAA,iBAAS,QAAA,CAAS,CAAT,EAAY,IAAZ,EAAkB,IAAlB,EAAT;;QACA,QAAA,CAAS,MAAT,EAAiB,iDAAjB;QACA,IAAA,CAAK,CAAL;QACA,QAAA,GAAW,SAHjB;;;QAMM,IAAA,GAAO,QAAA,CAAE,QAAF,CAAgB,0CAAhB;AAGb,cAAA,GAAA;;;UAAQ,UAAU,CAAC,mBAAX,GAAiC,CAAA,CAAE,QAAF;UACjC,OAAO,CAAC,GAAR,CAAY,0CAAZ,EAAwD,sBAAxD,EAAgF,mBAAmB,CAAE,CAAF,CAAnG;AACA,qEAAqC,CAAE;QALlC;QAMP,YAAA,GAAe,CAAA,MAAM,CAAC,CAAC,EAAE,CAAC,IAAI,CAAC,QAAV,CAAmB,IAAnB,EAAyB,QAAzB,CAAN;QACf,KAAA,CAAM,2CAAN,EAAmD,CAAA,MAAA,CAAA,CAAS,YAAT,CAAA,cAAA,CAAA,CAAsC,GAAA,CAAI,CAAE,QAAF,CAAJ,CAAtC,CAAA,CAAnD;QACA,IAAA,CAAK,SAAA,CAAU,iCAAV,EAA6C,CAAE,QAAF,CAA7C,CAAL;AACA,eAAO,IAAA,CAAA;MAhBK,CAAP;IADqB,EA5ChC;;WAgEE,IAAC,CAAA,YAAD,GAAgB,QAAA,CAAE,CAAF,CAAA;AAClB,UAAA,QAAA;;;;;;;;;;;;;;;;;MAgBI,QAAQ,CAAC,aAAT,CAAwB,CAAC,CAAC,WAA1B,EAhBJ;;MAkBI,QAAA,GAAY;MACZ,QAAQ,CAAC,IAAT,CAAc,IAAC,CAAA,OAAD,CAA8B,CAA9B,CAAd;MACA,QAAQ,CAAC,IAAT,CAAc,IAAC,CAAA,0BAAD,CAA8B,CAA9B,CAAd;MACA,QAAQ,CAAC,IAAT,CAAc,MAAA,CAAO,QAAA,CAAE,CAAF,CAAA;eAAS,OAAA,CAAQ,2BAAR,EAAqC,CAArC;MAAT,CAAP,CAAd,EArBJ;;MAuBI,QAAA,CAAS,MAAT,EAAiB,mCAAjB;AACA,aAAO,EAAE,CAAC,IAAH,CAAQ,GAAA,QAAR;IAzBO;EAlEa;;EA6F/B,4BAA4B,CAAC,KAA7B,CAAmC,SAAnC,EA/PA;;;;;EAoQA,IAAC,CAAA,CAAD,GAAK,QAAA,CAAA,CAAA;WAAG,IAAI,OAAJ,CAAY,KAAA,CAAE,OAAF,CAAA,GAAA;AACpB,UAAA,CAAA,EAAA,UAAA,EAAA,QAAA,EAAA,MAAA;;MACE,OAAO,CAAC,EAAR,CAAW,QAAX,EAAqB,MAAA,QAAA,CAAA,CAAA,EAAA;;;QAGnB,IAAA,CAAK,yBAAL;QACA,MAAM,CAAC,CAAC,EAAE,CAAC,IAAI,CAAC,KAAV,CAAgB;UAAE,eAAA,EAAiB;QAAnB,CAAhB;QACN,MAAM,CAAC,CAAC,EAAE,CAAC,OAAO,CAAC,KAAb,CAAA;eACN,OAAO,CAAC,IAAR,CAAA;MANmB,CAArB,EADF;;MASE,CAAA,GACE;QAAA,QAAA,EAAc,IAAA,CAAK,SAAL,EAAgB,QAAA,CAAE,CAAF,CAAA;iBAAS,MAAA,CAAO,CAAP,EAAU;YAAA,QAAA,EAAU;UAAV,CAAV;QAAT,CAAhB;MAAd,EAVJ;;MAYE,CAAC,CAAC,WAAF,GAAgB,IAAI,CAAC,OAAL,CAAa,IAAI,CAAC,IAAL,CAAU,SAAV,EAAqB,mBAArB,CAAb;MAChB,CAAC,CAAC,WAAF,GAAgB,IAAI,CAAC,IAAL,CAAU,CAAC,CAAC,WAAZ,EAAyB,kBAAzB;MAChB,CAAC,CAAC,WAAF,GAAgB,IAAI,CAAC,IAAL,CAAU,CAAC,CAAC,WAAZ,EAAyB,iBAAzB;MAChB,QAAA,GAAgB,GAflB;;MAiBE,MAAA,GAAgB,CAAA,MAAM,EAAE,CAAC,uBAAH,CAA2B,CAAC,CAAC,WAA7B,CAAN;MAChB,UAAA,GAAgB,QAAA,CAAE,CAAF,CAAA;eAAS,CAAI,GAAG,CAAC,IAAJ,CAAS,CAAT;MAAb,EAlBlB;;MAoBE,QAAQ,CAAC,IAAT,CAAc,MAAd,EApBF;;;AAoBiE,qDAG/D,QAAQ,CAAC,IAAT,CAAc,EAAE,CAAC,MAAH,CAAA,CAAd;AAA6E,uCAC7E,QAAQ,CAAC,IAAT,CAAc,QAAQ,CAAC,iBAAT,CAAA,CAAd;MACA,QAAQ,CAAC,IAAT,CAAc,SAAS,CAAC,OAAV,CAAkB,IAAlB,CAAd,EAzBF;;MA2BE,QAAQ,CAAC,IAAT,CAAc,CAAA,CAAE;QAAE,QAAA,EAAU;MAAZ,CAAF,EAA6B,qBAAA,CAAA,CAA7B,CAAd;MACA,QAAQ,CAAC,IAAT,CAAc,MAAA,CAAO,QAAA,CAAE,CAAF,CAAA;eAAS,QAAA,CAAS,MAAT,EAAiB,CAAA,WAAA,CAAA,CAAc,GAAA,CAAI,CAAJ,CAAd,CAAA,CAAjB;MAAT,CAAP,CAAd;MACA,QAAQ,CAAC,IAAT,CAAc,IAAI,CAAC,sBAAL,CAAA,CAAd;MACA,QAAQ,CAAC,IAAT,CAAc,IAAI,CAAC,YAAL,CAAA,CAAd,EA9BF;;MAgCE,QAAQ,CAAC,IAAT,CAAc,IAAI,CAAC,SAAL,CAAA,CAAd;AAAuE,6CACvE,QAAQ,CAAC,IAAT,CAAc,IAAI,CAAC,UAAL,CAAA,CAAd;MACA,QAAQ,CAAC,IAAT,CAAc,IAAI,CAAC,SAAL,CAAA,CAAd,EAlCF;;AAkCuF,+BAErF,QAAQ,CAAC,IAAT,CAAc,SAAS,CAAC,YAAV,CAAuB,CAAvB,CAAd;MACA,QAAQ,CAAC,IAAT,CAAc,KAAA,CAAM;QAAE,KAAA,EAAO;MAAT,CAAN,CAAd,EArCF;;MAuCE,QAAQ,CAAC,IAAT,CAAc,MAAA,CAAO,CAAA,CAAA,GAAA;eACnB,OAAA,CAAA;MADmB,CAAP,CAAd;MAEA,QAAA,CAAS,MAAT,EAAiB,GAAjB;MACA,EAAE,CAAC,IAAH,CAAQ,GAAA,QAAR;AACA,aAAO;IA5CW,CAAZ;EAAH,EApQL;;;EAoTA,IAAG,MAAA,KAAU,OAAO,CAAC,IAArB;IAAkC,CAAA,KAAA,CAAA,CAAA,GAAA,EAAA;;MAEhC,MAAM,IAAC,CAAA,CAAD,CAAA,EADR;;;;;;aAOE,IAAA,CAAK,IAAL;IARgC,CAAA,IAAlC;;AApTA",
  "sourcesContent": [
    "\n'use strict'\n\n\n############################################################################################################\nCND                       = require 'cnd'\nrpr                       = CND.rpr\nbadge                     = 'INTERPLOT/SCRATCH'\ndebug                     = CND.get_logger 'debug',     badge\nalert                     = CND.get_logger 'alert',     badge\nwhisper                   = CND.get_logger 'whisper',   badge\nwarn                      = CND.get_logger 'warn',      badge\nhelp                      = CND.get_logger 'help',      badge\nurge                      = CND.get_logger 'urge',      badge\ninfo                      = CND.get_logger 'info',      badge\necho                      = CND.echo.bind CND\nPATH                      = require 'path'\nFS                        = require 'fs'\n{ jr, }                   = CND\nassign                    = Object.assign\njoin_path                 = ( P... ) -> PATH.resolve PATH.join P...\n#...........................................................................................................\ntypes                     = require '../types'\n{ isa\n  validate\n  cast\n  type_of }               = types\n#...........................................................................................................\n# DATOM                     = new ( require 'datom' ).Datom { dirty: false, }\nDATOM                     = require 'datom'\n{ new_datom\n  stamp\n  lets\n  freeze\n  select }                = DATOM.export()\n#...........................................................................................................\nSP                        = require 'steampipes'\n# SP                        = require '../../apps/steampipes'\n{ $\n  $async\n  $drain\n  $watch\n  $before_first\n  $once_async_before_first\n  $show  }                = SP.export()\n#...........................................................................................................\nafter                     = ( dts, f ) -> setTimeout f, dts * 1000\nsleep                     = ( dts ) -> new Promise ( done ) -> after dts, done\n# page_html_path            = PATH.resolve PATH.join __dirname, '../../../public/main.html'\n# PUPPETEER                 = require 'puppeteer'\nINTERTEXT                 = require 'intertext'\n{ HTML, }                 = INTERTEXT\n#...........................................................................................................\nRC                        = require '../remote-control'\nDATAMILL                  = {}\nDEMO                      = {}\nINTERPLOT                 = {}\n_settings                 = DATOM.freeze require '../settings'\n\nprogress = ( P... ) -> echo ( CND.cyan p for p in P )...\n\n#===========================================================================================================\n#\n#-----------------------------------------------------------------------------------------------------------\n$XXX_datoms_from_html = ->\n  return $ ( x, send ) ->\n    progress '^P1^', rpr x\n    if x is '<p>A concise introduction to the things discussed below.</p>\\n'\n      send freeze { $key: '<p', }\n      send freeze { $key: '^text', text: \"(simulated) A concise introduction to the things discussed below.\" }\n      send freeze { $key: '>p', }\n\n#===========================================================================================================\n#\n#-----------------------------------------------------------------------------------------------------------\nINTERTEXT.$append = ( text ) ->\n  validate.text text\n  return $ ( x, send ) ->\n    send if ( isa.text x ) then x + text else x\n    return null\n\n\n#===========================================================================================================\n#\n#-----------------------------------------------------------------------------------------------------------\nDATAMILL.$stop_on_stop_tag = ->\n  has_stopped = false\n  line_nr     = 0\n  return $ ( line, send ) =>\n    return if has_stopped\n    line_nr++\n    if /^\\s*<stop\\/>/.test line\n      has_stopped = true\n      send new_datom '^stop', $: { line_nr, }\n      return send.end()\n    send line\n\n\n#===========================================================================================================\n#\n#-----------------------------------------------------------------------------------------------------------\nDEMO.$grab_first_paragraphs = ->\n  p_count   = 0\n  within_p  = false\n  return $ ( d, send ) =>\n    return send.end() if p_count >= 2\n    switch d.$key\n      when '<p'\n        within_p = true\n        send d\n      when '>p'\n        within_p = false\n        p_count++\n        send d\n      else\n        return send d if within_p\n    return null\n\n#-----------------------------------------------------------------------------------------------------------\nDEMO.$filter_text = ->\n  return $ ( d, send ) =>\n    return unless select d, '^text'\n    send d.text\n\n# #-----------------------------------------------------------------------------------------------------------\n# DEMO.$consolidate_text = ->\n#   ### TAINT use SP.$collect() ?? ###\n#   last      = Symbol 'last'\n#   collector = []\n#   return $ { last, }, ( d, send ) =>\n#     return send collector.join '' if d is last\n#     validate.text d\n#     collector.push d\n\n#-----------------------------------------------------------------------------------------------------------\nDEMO.$blockify = ->\n  last      = Symbol 'last'\n  collector = []\n  return $ { last, }, ( d, send ) =>\n    if d is last\n      text = collector.join ''\n      return send new_datom '^mkts:block', { text, }\n    validate.text d\n    collector.push d\n\n#-----------------------------------------------------------------------------------------------------------\nDEMO.$hyphenate = ->\n  return $ ( d, send ) =>\n    return send d unless select d, '^mkts:block'\n    send lets d, ( d ) => d.text = INTERTEXT.HYPH.hyphenate d.text\n\n#-----------------------------------------------------------------------------------------------------------\nDEMO.$as_slabs = ->\n  return $ ( d, send ) =>\n    return send d unless select d, '^mkts:block'\n    send stamp d\n    send new_datom '^slabs', INTERTEXT.SLABS.slabs_from_text d.text\n    # send lets d, ( d ) => d.text = INTERTEXT.hyphenate d.text\n\n\n#===========================================================================================================\n#\n#-----------------------------------------------------------------------------------------------------------\nprovide_interplot_extensions = ->\n\n  #-----------------------------------------------------------------------------------------------------------\n  leapfrog = ( d, send, done ) ->\n    ### NOTE Helper function to slightly simplify quick exit from (async) transforms; used to make up for\n    the still missing `{ leapfrog, }` modifier for `$async` transforms. Does very little but helps to mark\n    those points where the modifier would have been used. Usage:\n\n    ```coffee\n    $t = -> $async ( d, send, done ) =>\n      return ( leapfrog d, send, done ) unless select d, '^key-i'm-waiting-for\n      ...\n    ```\n    ###\n    send d\n    done()\n\n  #-----------------------------------------------------------------------------------------------------------\n  @$launch = ( S ) ->\n    ### TAINT settings to be passed in via `S`? ###\n    url               = 'file:///home/flow/jzr/interplot/public/demo-galley/main.html'\n    wait_for_selector = '#page-ready'\n    gui               = false\n    gui               = true\n    #.........................................................................................................\n    return $once_async_before_first ( send, done ) =>\n      progress '^P2^', \"INTERPLOT_extensions.$launch\"\n      send new_datom '^interplot:launch-browser'\n      urge \"launching browser...\"\n      S.rc = await RC.new_remote_control { url, wait_for_selector, gui, }\n      urge \"browser launched\"\n      #.....................................................................................................\n      ### TAINT how to best expose libraries in browser context? ###\n      await S.rc.page.exposeFunction 'TEMPLATES_slug',     ( P... ) => ( require '../template-elements' ).slug     P...\n      await S.rc.page.exposeFunction 'TEMPLATES_pointer',  ( P... ) => ( require '../template-elements' ).pointer  P...\n      await S.rc.page.evaluate ->\n        ( $ document ).ready ->\n          console.log '^scratch/launch@6745^', 'TEMPLATES_slug()', await TEMPLATES_slug()\n          console.log '^scratch/launch@6745^', 'TEMPLATES_pointer()', await TEMPLATES_pointer()\n      debug '^scratch/$launch@883^', \"slug():\",     ( require '../template-elements' ).slug\n      debug '^scratch/$launch@883^', \"pointer():\",  ( require '../template-elements' ).pointer\n      #.....................................................................................................\n      send new_datom '^interplot:browser-ready'\n      return done()\n\n  #-----------------------------------------------------------------------------------------------------------\n  @$find_first_target_element = ( S ) ->\n    return $async ( d, send, done ) =>\n      return ( leapfrog d, send, done ) unless select d, '^interplot:browser-ready'\n      progress '^P3^', \"INTERPLOT_extensions.$find_first_target_element\"\n      send d\n      selector = 'column' # 'column:nth(0)'\n      # debug '^22298^', await S.rc.page.$ selector\n      # debug '^22298^', await S.rc.page.$ 'column'\n      opsf = ( selector ) -> ### NOTE: OPSF = On-Page Script Function ###\n        ### TAINT race condition or can we rely on page ready? ###\n        # ( $ document ).ready ->\n        globalThis.xxx_target_elements = $ selector\n        console.log '^scratch/find_first_target_element@3987^', \"xxx_target_elements:\", xxx_target_elements[ 0 ]\n        return globalThis.xxx_target_elements?.length\n      column_count = await S.rc.page.evaluate opsf, selector\n      debug '^scratch/find_first_target_element@22298^', \"found #{column_count} elements for #{rpr { selector, }}\"\n      send new_datom '^interplot:first-target-element', { selector, }\n      return done()\n\n  #-----------------------------------------------------------------------------------------------------------\n  @$text_as_pdf = ( S ) ->\n    ###\n    * [x] launch browser\n    * [ ] establish flow order of target elements (columns) in document\n    * [ ] insert `pointer#pointer` DOM element into page\n    * [ ] ignore events other than `^slabs` FTTB\n    * [ ] determine leftmost, rightmost indexes into slugs that is close to one line worth of text\n    * [ ] call OPS method with assembled text to determine metrics of text at insertion point\n    * [ ] depending on metrics, accept line, try new one, or accept previous attempt\n    * [ ] call OPS method to accept good line and remove other\n    * [ ] check metrics whether vertical column limit has been reached; if so, reposition pointer\n\n    NOTE procedure as detailed here may suffer from performance issue due to repeated IPC; might be better\n    to preproduce and send more line data to reduce IPC calls. Check for ways that\n    `INTERTEXT.SLABS.assemble()` can be made available to OPS.\n\n    ###\n    validate.nonempty_text  S.target_path\n    #..........................................................................................................\n    pipeline  = []\n    pipeline.push @$launch                      S\n    pipeline.push @$find_first_target_element   S\n    pipeline.push $watch ( d ) -> whisper '^scratch/$text_as_pdf@334', d\n    #..........................................................................................................\n    progress '^P4^', \"INTERPLOT_extensions.$text_as_pdf\"\n    return SP.pull pipeline...\n\nprovide_interplot_extensions.apply INTERPLOT\n\n#===========================================================================================================\n#\n#-----------------------------------------------------------------------------------------------------------\n@f = -> new Promise ( resolve ) =>\n  #.........................................................................................................\n  process.on 'SIGINT', ->\n    ### Make sure browser is closed gracefully so as to continue in previous state and avoid \"do you want to\n    restore\" dialog. This solution works sometimes but not always. ###\n    warn \"Caught interrupt signal\"\n    await S.rc.page.close { runBeforeUnload: true, }\n    await S.rc.browser.close()\n    process.exit()\n  #.........................................................................................................\n  S =\n    settings:     lets _settings, ( d ) -> assign d, headless: false\n  #.........................................................................................................\n  S.sample_home = PATH.resolve PATH.join __dirname, '../../sample-data'\n  S.source_path = PATH.join S.sample_home, 'sample-text.html'\n  S.target_path = PATH.join S.sample_home, 'sample-text.pdf'\n  pipeline      = []\n  # source        = SP.read_from_file S.source_path\n  source        = await SP._KLUDGE_file_as_buffers S.source_path\n  not_a_text    = ( d ) -> not isa.text d\n  #.........................................................................................................\n  pipeline.push source                                           ### ↓↓↓ arbitrarily chunked buffers ↓↓↓ ###\n  #.........................................................................................................\n  ### TAINT implement `$split()` w/ newline/whitespace-preserving ###\n  pipeline.push SP.$split()                                                    ### ↓↓↓ lines of text ↓↓↓ ###\n  pipeline.push DATAMILL.$stop_on_stop_tag()\n  pipeline.push INTERTEXT.$append '\\n'\n  #.........................................................................................................\n  pipeline.push $ { leapfrog: not_a_text, }, $XXX_datoms_from_html()\n  pipeline.push $watch ( d ) -> progress '^P5^', \"(pipeline) #{rpr d}\"\n  pipeline.push DEMO.$grab_first_paragraphs()\n  pipeline.push DEMO.$filter_text()\n  # pipeline.push DEMO.$consolidate_text()\n  pipeline.push DEMO.$blockify()                                         ### ↓↓↓ text/HTML of blocks ↓↓↓ ###\n  pipeline.push DEMO.$hyphenate()\n  pipeline.push DEMO.$as_slabs()                                                       ### ↓↓↓ slabs ↓↓↓ ###\n  #.........................................................................................................\n  pipeline.push INTERPLOT.$text_as_pdf S\n  pipeline.push $show { title: '--334-->', }\n  #.........................................................................................................\n  pipeline.push $drain =>\n    resolve()\n  progress '^P6^', \"f\"\n  SP.pull pipeline...\n  return null\n\n\n############################################################################################################\nif module is require.main then do =>\n  #.........................................................................................................\n  await @f()\n  # settings =\n  #   product:          'firefox'\n  #   headless:         false\n  #   executablePath:   '/usr/bin/firefox'\n  # await ( require 'puppeteer' ).launch settings\n  help 'ok'\n\n\n\n\n"
  ]
}