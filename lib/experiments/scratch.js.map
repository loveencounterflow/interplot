{
  "version": 3,
  "file": "scratch.js",
  "sourceRoot": "../..",
  "sources": [
    "src/experiments/scratch.coffee"
  ],
  "names": [],
  "mappings": "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",
  "sourcesContent": [
    "\n'use strict'\n\n\n############################################################################################################\nCND                       = require 'cnd'\nrpr                       = CND.rpr\nbadge                     = 'INTERPLOT/SCRATCH'\ndebug                     = CND.get_logger 'debug',     badge\nalert                     = CND.get_logger 'alert',     badge\nwhisper                   = CND.get_logger 'whisper',   badge\nwarn                      = CND.get_logger 'warn',      badge\nhelp                      = CND.get_logger 'help',      badge\nurge                      = CND.get_logger 'urge',      badge\ninfo                      = CND.get_logger 'info',      badge\necho                      = CND.echo.bind CND\nPATH                      = require 'path'\nFS                        = require 'fs'\n{ jr, }                   = CND\nassign                    = Object.assign\njoin_path                 = ( P... ) -> PATH.resolve PATH.join P...\n#...........................................................................................................\ntypes                     = require '../types'\n{ isa\n  validate\n  cast\n  type_of }               = types\n#...........................................................................................................\n# DATOM                     = new ( require 'datom' ).Datom { dirty: false, }\nDATOM                     = require 'datom'\n{ new_datom\n  stamp\n  lets\n  select }                = DATOM.export()\n#...........................................................................................................\nSP                        = require 'steampipes'\n# SP                        = require '../../apps/steampipes'\n{ $\n  $async\n  $drain\n  $watch\n  $before_first\n  $async_before_first\n  $show  }                = SP.export()\n#...........................................................................................................\nafter                     = ( dts, f ) -> setTimeout f, dts * 1000\nsleep                     = ( dts ) -> new Promise ( done ) -> after dts, done\n# page_html_path            = PATH.resolve PATH.join __dirname, '../../../public/main.html'\n# PUPPETEER                 = require 'puppeteer'\nINTERTEXT                 = require 'intertext'\n{ HTML, }                 = INTERTEXT\n#...........................................................................................................\nRC                        = require '../remote-control'\nDATAMILL                  = {}\nDEMO                      = {}\nINTERPLOT                 = {}\n_settings                 = DATOM.freeze require '../settings'\n\n\n\n#===========================================================================================================\n#\n#-----------------------------------------------------------------------------------------------------------\nINTERTEXT.$append = ( text ) ->\n  validate.text text\n  return $ ( x, send ) ->\n    send if ( isa.text x ) then x + text else x\n    return null\n\n\n#===========================================================================================================\n#\n#-----------------------------------------------------------------------------------------------------------\nDATAMILL.$stop_on_stop_tag = ->\n  has_stopped = false\n  line_nr     = 0\n  return $ ( line, send ) =>\n    return if has_stopped\n    line_nr++\n    if /^\\s*<stop\\/>/.test line\n      has_stopped = true\n      send new_datom '^stop', $: { line_nr, }\n      return send.end()\n    send line\n\n\n#===========================================================================================================\n#\n#-----------------------------------------------------------------------------------------------------------\nDEMO.$grab_first_paragraphs = ->\n  p_count   = 0\n  within_p  = false\n  return $ ( d, send ) =>\n    return send.end() if p_count >= 2\n    switch d.$key\n      when '<p'\n        within_p = true\n        send d\n      when '>p'\n        within_p = false\n        p_count++\n        send d\n      else\n        return send d if within_p\n    return null\n\n#-----------------------------------------------------------------------------------------------------------\nDEMO.$filter_text = ->\n  return $ ( d, send ) =>\n    return unless select d, '^text'\n    send d.text\n\n# #-----------------------------------------------------------------------------------------------------------\n# DEMO.$consolidate_text = ->\n#   ### TAINT use SP.$collect() ?? ###\n#   last      = Symbol 'last'\n#   collector = []\n#   return $ { last, }, ( d, send ) =>\n#     return send collector.join '' if d is last\n#     validate.text d\n#     collector.push d\n\n#-----------------------------------------------------------------------------------------------------------\nDEMO.$blockify = ->\n  last      = Symbol 'last'\n  collector = []\n  return $ { last, }, ( d, send ) =>\n    if d is last\n      text = collector.join ''\n      return send new_datom '^mkts:block', { text, }\n    validate.text d\n    collector.push d\n\n#-----------------------------------------------------------------------------------------------------------\nDEMO.$hyphenate = ->\n  return $ ( d, send ) =>\n    return send d unless select d, '^mkts:block'\n    send lets d, ( d ) => d.text = INTERTEXT.HYPH.hyphenate d.text\n\n#-----------------------------------------------------------------------------------------------------------\nDEMO.$as_slabs = ->\n  return $ ( d, send ) =>\n    return send d unless select d, '^mkts:block'\n    send stamp d\n    send new_datom '^slabs', INTERTEXT.SLABS.slabs_from_text d.text\n    # send lets d, ( d ) => d.text = INTERTEXT.hyphenate d.text\n\n\n#===========================================================================================================\n#\n#-----------------------------------------------------------------------------------------------------------\nprovide_interplot_extensions = ->\n\n  #-----------------------------------------------------------------------------------------------------------\n  leapfrog = ( d, send, done ) ->\n    ### NOTE Helper function to slightly simplify quick exit from (async) transforms; used to make up for\n    the still missing `{ leapfrog, }` modifier for `$async` transforms. Does very little but helps to mark\n    those points where the modifier would have been used. Usage:\n\n    ```coffee\n    $t = -> $async ( d, send, done ) =>\n      return ( leapfrog d, send, done ) unless select d, '^key-i'm-waiting-for\n      ...\n    ```\n    ###\n    send d\n    done()\n\n  #-----------------------------------------------------------------------------------------------------------\n  @$launch = ( S ) ->\n    ### TAINT settings to be passed in via `S`? ###\n    url               = 'file:///home/flow/jzr/interplot/public/demo-galley/main.html'\n    wait_for_selector = '#page-ready'\n    gui               = true\n    #.........................................................................................................\n    return $async_before_first ( send, done ) =>\n      send new_datom '^interplot:launch-browser'\n      urge \"launching browser...\"\n      S.rc = await RC.new_remote_control { url, wait_for_selector, gui, }\n      urge \"browser launched\"\n      #.....................................................................................................\n      ### TAINT how to best expose libraries in browser context? ###\n      await S.rc.page.exposeFunction 'TEMPLATES_slug',     ( P... ) => ( require '../templates' ).slug     P...\n      await S.rc.page.exposeFunction 'TEMPLATES_pointer',  ( P... ) => ( require '../templates' ).pointer  P...\n      #.....................................................................................................\n      send new_datom '^interplot:browser-ready'\n      return done()\n\n  #-----------------------------------------------------------------------------------------------------------\n  @$find_first_target_element = ( S ) ->\n    return $async ( d, send, done ) =>\n      return ( leapfrog d, send, done ) unless select d, '^interplot:browser-ready'\n      send d\n      selector = 'column:first' # 'column:nth(0)'\n      send new_datom '^interplot:first-target-element', { selector, }\n      return done()\n\n  #-----------------------------------------------------------------------------------------------------------\n  @$text_as_pdf = ( S ) ->\n    ###\n    * [x] launch browser\n    * [ ] establish flow order of target elements (columns) in document\n    * [ ] insert `pointer#pointer` DOM element into page\n    * [ ] ignore events other than `^slabs` FTTB\n    * [ ] determine leftmost, rightmost indexes into slugs that is close to one line worth of text\n    * [ ] call OPS method with assembled text to determine metrics of text at insertion point\n    * [ ] depending on metrics, accept line, try new one, or accept previous attempt\n    * [ ] call OPS method to accept good line and remove other\n    * [ ] check metrics whether vertical column limit has been reached; if so, reposition pointer\n\n    NOTE procedure as detailed here may suffer from performance issue due to repeated IPC; might be better\n    to preproduce and send more line data to reduce IPC calls. Check for ways that\n    `INTERTEXT.SLABS.assemble()` can be made available to OPS.\n\n    ###\n    validate.nonempty_text  S.target_path\n    #..........................................................................................................\n    pipeline  = []\n    pipeline.push @$launch                      S\n    pipeline.push @$find_first_target_element   S\n    #..........................................................................................................\n    return SP.pull pipeline...\n\nprovide_interplot_extensions.apply INTERPLOT\n\n#===========================================================================================================\n#\n#-----------------------------------------------------------------------------------------------------------\n@f = -> new Promise ( resolve ) =>\n  S =\n    settings:     lets _settings, ( d ) -> assign d, headless: false\n    browser:      null\n    page:         null\n  #.........................................................................................................\n  S.sample_home = PATH.resolve PATH.join __dirname, '../../sample-data'\n  S.source_path = PATH.join S.sample_home, 'sample-text.html'\n  S.target_path = PATH.join S.sample_home, 'sample-text.pdf'\n  pipeline      = []\n  # source        = SP.read_from_file S.source_path\n  source        = await SP._KLUDGE_file_as_buffers S.source_path\n  not_a_text    = ( d ) -> not isa.text d\n  #.........................................................................................................\n  pipeline.push source                                           ### ↓↓↓ arbitrarily chunked buffers ↓↓↓ ###\n  #.........................................................................................................\n  ### TAINT implement `$split()` w/ newline/whitespace-preserving ###\n  pipeline.push SP.$split()                                                    ### ↓↓↓ lines of text ↓↓↓ ###\n  pipeline.push DATAMILL.$stop_on_stop_tag()\n  pipeline.push INTERTEXT.$append '\\n'\n  #.........................................................................................................\n  pipeline.push $ { leapfrog: not_a_text, }, HTML.$html_as_datoms()\n  pipeline.push DEMO.$grab_first_paragraphs()\n  pipeline.push DEMO.$filter_text()\n  # pipeline.push DEMO.$consolidate_text()\n  pipeline.push DEMO.$blockify()                                         ### ↓↓↓ text/HTML of blocks ↓↓↓ ###\n  pipeline.push DEMO.$hyphenate()\n  pipeline.push DEMO.$as_slabs()                                                       ### ↓↓↓ slabs ↓↓↓ ###\n  #.........................................................................................................\n  pipeline.push INTERPLOT.$text_as_pdf S\n  pipeline.push $show()\n  #.........................................................................................................\n  pipeline.push $drain =>\n    resolve()\n  SP.pull pipeline...\n  return null\n\n\n############################################################################################################\nif module is require.main then do =>\n  await @f()\n  help 'ok'\n\n\n"
  ]
}