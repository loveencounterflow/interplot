{
  "version": 3,
  "file": "linemaker.js",
  "sourceRoot": "..",
  "sources": [
    "src/linemaker.coffee"
  ],
  "names": [],
  "mappings": "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",
  "sourcesContent": [
    "\n'use strict'\n\n\n############################################################################################################\nCND                       = require 'cnd'\nrpr                       = CND.rpr\nbadge                     = 'INTERPLOT/LINEMAKER'\ndebug                     = CND.get_logger 'debug',     badge\nalert                     = CND.get_logger 'alert',     badge\nwhisper                   = CND.get_logger 'whisper',   badge\nwarn                      = CND.get_logger 'warn',      badge\nhelp                      = CND.get_logger 'help',      badge\nurge                      = CND.get_logger 'urge',      badge\ninfo                      = CND.get_logger 'info',      badge\nPATH                      = require 'path'\nFS                        = require 'fs'\n{ jr, }                   = CND\nassign                    = Object.assign\njoin_path                 = ( P... ) -> PATH.resolve PATH.join P...\n#...........................................................................................................\ntypes                     = require './types'\n{ isa\n  validate\n  cast\n  type_of }               = types\nSP                        = require 'steampipes'\n{ $\n  $drain }                = SP.export()\nDATOM                     = require 'datom'\n{ new_datom\n  select }                = DATOM.export()\nHYPHENATOR                = require './hyphenator'\nhyphenate                 = HYPHENATOR.new_hyphenator()\n\n#-----------------------------------------------------------------------------------------------------------\n@demo_hyphenation = ->\n  texts = [\n    \"typesetting\"\n    \"supercalifragilistic\"\n    \"phototypesetter\"\n    \"hairstylist\"\n    \"gargantuan\"\n    \"the lopsided honeybadger\"\n    ]\n  for text in texts\n    htext = hyphenate text\n    htext = htext.replace /\\u00ad/g, '-'\n    info htext\n  return null\n\n\n###\n\n'Slab': the part of a word that is separated from others by breakpoints\n\n> The addressable unit of memory on the NCR 315 series is a \"slab\", short for \"syllable\", consisting of 12\n> data bits and a parity bit. Its size falls between a byte and a typical word (hence the name, 'syllable').\n> A slab may contain three digits (with at sign, comma, space, ampersand, point, and minus treated as\n> digits) or two alphabetic characters of six bits each.—[Wikipedia, \"NCR\n> 315\"](https://en.wikipedia.org/wiki/NCR_315)\n\n###\n\n#===========================================================================================================\n#\n#-----------------------------------------------------------------------------------------------------------\nreconstitute_text = ( slab ) ->\n  R = slab.txt\n  if slab.rhs is 'shy' then R += '-'\n  else if slab.rhs is 'spc' then R += ' '\n  return R\n@slabs_from_paragraph = ( text ) ->\n  ### TAINT avoid to instantiate new parser for each paragraph ###\n  ### TAINT consider to use pipestreaming instead of looping ###\n  parse_html  = SP.HTML.new_onepiece_parser()\n  ctx_stack   = []\n  R           = []\n  for d in parse_html text\n    ### TAINT should check for matching tags ###\n    ### TAINT must also store HTML attributes ###\n    if ( select d, '<' )      then ctx_stack.push d.$key[ 1 .. ]\n    else if ( select d, '>' ) then ctx_stack.pop()\n    #.......................................................................................................\n    if ( select d, '<' ) and ( d.is_block ? false )\n      info CND.white '————————————————————————————————————— ' + d.$key\n      continue\n    #.......................................................................................................\n    if ( select d, '^text' )\n      text      = d.text.replace /\\n/g, ' '\n      slabs     = @slabs_from_text text\n      R.push slabs\n      # for slab in slabs.$value\n      #   rhs = if slab.rhs? then slab.rhs else null\n      opener  = \"<slug>\" + ( \"<#{element}>\" for element in ctx_stack ).join ''\n      closer  = \"</slug>\"\n      info ( CND.yellow opener ), \\\n        ( ( ( CND.blue reconstitute_text slab ) for slab in slabs.$value ). join CND.grey '|' ), \\\n        ( CND.yellow closer )\n      continue\n    whisper d.$key\n  #.........................................................................................................\n  return new_datom '^slab-blocks', R\n\n#-----------------------------------------------------------------------------------------------------------\n@slabs_from_text = ( text ) ->\n  text          = hyphenate text\n  ### TAINT benchmark against https://github.com/hfour/linebreak-ts ###\n  LineBreaker   = require 'linebreak'\n  breaker       = new LineBreaker text\n  prv_position  = 0\n  slabs         = []\n  ### LBO: line break opportunity ###\n  while ( lbo = breaker.nextBreak() )?\n    txt           = text[ prv_position ... lbo.position ]\n    prv_position  = lbo.position\n    last_codeunit = txt[ txt.length - 1 ]\n    slab          = {}\n    if last_codeunit is HYPHENATOR.soft_hyphen_chr\n      slab.rhs      = 'shy'\n      txt           = txt[ ... txt.length - 1 ]\n    else if last_codeunit is '\\u0020'\n      ### TAINT in the future, we might want to consider other breaking (fixed or variable) spaces ###\n      slab.rhs      = 'spc'\n      txt           = txt[ ... txt.length - 1 ]\n    # debug '^876^', jr txt\n    slab.txt = txt\n    slabs.push slab\n  return new_datom '^slabs', slabs\n\n#-----------------------------------------------------------------------------------------------------------\n@demo_linebreak = ->\n  LineBreaker = require 'linebreak'\n  keep_hyphen = String.fromCodePoint 0x2011\n  shy         = String.fromCodePoint 0x00ad\n  nbsp        = String.fromCodePoint 0x00a0\n  text        = \"Super-cali#{keep_hyphen}frag#{shy}i#{shy}lis#{shy}tic\\nis a won#{shy}der#{shy}ful word我很喜歡這個單字。\"\n  breaker = new LineBreaker text\n  last = 0\n  ### LBO: line break opportunity ###\n  while ( lbo = breaker.nextBreak() )?\n    # get the string between the last break and this one\n    word  = text.slice last, lbo.position\n    xhy   = if isa.interplot_shy word then ( CND.gold '-' ) else ''\n    rq    = if lbo.required then '!' else ' '\n    word  = word.trimEnd()\n    info rq, ( jr word ), xhy\n    last = lbo.position\n  return null\n\n\n############################################################################################################\nif module is require.main then do =>\n  # @demo_linebreak()\n  # @demo_hyphenation()\n  html = \"\"\"<p><strong>Letterpress</strong> printing is a <em>technique of relief printing using a printing\n  press,</em> a process by which many copies are produced by <em>repeated direct impression of an inked,\n  raised surface</em> against sheets or a continuous roll of paper.</p> <p>A worker composes and locks\n  movable type into the ‘bed’ or ‘chase’ of a press, inks it, and presses paper against it to transfer the\n  ink from the type which creates an impression on the paper.</p>\"\"\"\n  text = \"\"\"Letterpress printing is a technique of relief printing using a printing press.\"\"\"\n  html = \"\"\"<p>#{text}</p>\"\"\"\n  # urge @slabs_from_paragraph html\n  urge @slabs_from_text text\n\n\n"
  ]
}