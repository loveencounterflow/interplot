{
  "version": 3,
  "file": "",
  "sourceRoot": "",
  "sources": [
    "../src/ops.coffee"
  ],
  "names": [],
  "mappings": "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",
  "sourcesContent": [
    "\nprovide_ops = ->\n\n  #-----------------------------------------------------------------------------------------------------------\n  @demo_wait_for_dom_ready = ->\n    ###\n    thx to https://stackoverflow.com/a/48514876/7568091\n\n    The observer event handler will trigger whenever any node is added or removed from the document. Inside\n    the handler, we then perform a contains check to determine if myElement is now in the document.\n\n    You don't need to iterate over each MutationRecord stored in mutations because you can perform the\n    document.contains check directly upon myElement.\n\n    To improve performance, replace document with the specific element that will contain myElement in the DOM.\n\n    ###\n    ###\n    var myElement = $(\"<div>hello world</div>\")[0];\n\n    var observer = new MutationObserver(function(mutations) {\n       if (document.contains(myElement)) {\n            console.log(\"It's in the DOM!\");\n            observer.disconnect();\n        }\n    });\n\n    observer.observe(document, {attributes: false, childList: true, characterData: false, subtree:true});\n\n    $(\"body\").append(myElement); // console.log: It's in the DOM!\n    ###\n    return null\n\n  # #-----------------------------------------------------------------------------------------------------------\n  # @_context_from_linenr = ( line_nr ) ->\n  #   R                 = {}\n  #   R.slug_id         = \"slug#{line_nr}\"\n  #   R.trim_id         = \"trim#{line_nr}\"\n  #   # R.left_flag_id    = \"lflag#{line_nr}\"\n  #   # R.right_flag_id   = \"rflag#{line_nr}\"\n  #   R.slug_dom        = document.getElementById R.slug_id\n  #   R.trim_dom        = document.getElementById R.trim_id\n  #   # R.lflag_dom       = document.getElementById R.left_flag_id\n  #   # R.rflag_dom       = document.getElementById R.right_flag_id\n  #   R.slug_rect       = as_plain_object R.slug_dom.getBoundingClientRect()\n  #   R.trim_rect       = as_plain_object R.trim_dom.getBoundingClientRect()\n  #   return R\n\n  #-----------------------------------------------------------------------------------------------------------\n  @_get_partial_slug = ( slabs, min_slab_idx, max_slab_idx ) ->\n    ### TAINT also return text usable on next invocation so that part will not have to be computed again ###\n    text      = ''\n    spc_count = 0\n    for slab_idx in [ min_slab_idx .. max_slab_idx ]\n      is_first_slab = slab_idx is min_slab_idx\n      is_last_slab  = slab_idx is max_slab_idx\n      slab          = slabs[ slab_idx ]\n      { txt, rhs, } = slab\n      #.......................................................................................................\n      switch rhs ? null\n        when null then null\n        #.....................................................................................................\n        when 'shy'\n          if is_last_slab\n            txt += '-'\n        #.....................................................................................................\n        when 'spc'\n          unless is_last_slab\n            spc_count++\n            txt += ' '\n        #.....................................................................................................\n        ### TAINT may wanrt to throw error or inform parent process ###\n        else warn '^interplot/OPS/_get_partial_slug@8012', \"ignoring slab.rhs #{jr rhs}\"\n      #.......................................................................................................\n      text += txt\n    #.........................................................................................................\n    return { text, spc_count, min_slab_idx, max_slab_idx, }\n\n  #-----------------------------------------------------------------------------------------------------------\n  @_adapt_margins_to_hanging_punctuation = ( ctx, partial_slug ) ->\n    # ### Apply optical margin correction: ###\n    ### a.k.a. margin kerning, optical margin alignment ###\n    ### see https://de.wikipedia.org/wiki/PdfTeX#Mikrotypographische_Erweiterungen ###\n    ### see https://en.wikipedia.org/wiki/Hanging_punctuation ###\n    ### see https://en.wikipedia.org/wiki/Optical_margin_alignment ###\n    ### \"Suggested Values for Optical Justification\" (https://en.wikipedia.org/wiki/Optical_margin_alignment)\n\n      These values may be suitable for common seriffed fonts like Times New Roman, Palatino, or Garamond.\n      Other fonts may need different values.\n\n      Characters  Value\n      \" “ ” ' ‘ ’, .  100%\n      hyphen  75%\n      en-dash 50%\n      em-dash 25%\n      A T V W Y 20%\n      C O 10%\n    ###\n    # ### TAINT just a demo, must adjust to font, size, etc; also depends on user preferences ###\n    # ### TAINT adjust width of `<trim/>` element ###\n    # chrs          = Array.from txt\n    # first_chr     = chrs[ 0 ]\n    # last_chr      = chrs[ chrs.length - 1 ]\n    # if is_first_slab and ( margin = margins[ first_chr ]?.left  )?\n    #   trim_dom.style.marginLeft = margin\n    # if is_last_slab  and ( margin = margins[ last_chr  ]?.right )?\n    #   trim_dom.style.marginRight = margin\n\n  #-----------------------------------------------------------------------------------------------------------\n  @XXX_show_caret_style = ( ctx ) ->\n    css = ctx.caret_style\n    # log '^3334-1^', [ ( css.getPropertyValue 'font-family' ), ( css.getPropertyValue 'font-size' ), ( css.getPropertyValue 'font-style' ), ]\n    # log '^3334-2^', [ ( css[ 'font-family' ] ), ( css[ 'font-size' ] ), ( css[ 'font-style' ] ), ]\n    log '^3334-3^', ( css[ k ] for k in µ.TMP._css_font_properties ).join '/'\n    return null\n\n  #-----------------------------------------------------------------------------------------------------------\n  @_metrics_from_partial_slug = ( ctx, partial_slug ) ->\n    slug_dom          = µ.DOM.deep_copy ctx.slug_stencil\n    trim_dom          = µ.DOM.select_from slug_dom, 'trim'\n    ctx.prv_dom_id++\n    µ.DOM.set slug_dom, 'id', \"slug#{ctx.prv_dom_id}\"\n    µ.DOM.set trim_dom, 'id', \"trim#{ctx.prv_dom_id}\"\n    column_dom        = ctx.columns_dom[ ctx.columns_idx ]\n    #.........................................................................................................\n    µ.DOM.prepend trim_dom, partial_slug.text, ctx.caret_dom\n    µ.DOM.append column_dom, slug_dom\n    @XXX_show_caret_style ctx\n    width_mm          = GAUGE.width_mm_of trim_dom\n    overshoot_mm      = width_mm - ctx.column_width_mm\n    spc_delta_mm      = if partial_slug.spc_count < 1 then null else -( overshoot_mm / partial_slug.spc_count )\n    ### NOTE here we use a boolean quality assessment; a more refined algorithm should use points for\n    to differentiate between less and more desirable fittings based on delta space added to or subtracted\n    from all space characters, presence or absence of hyphen and so on ###\n    fitting_ok        = overshoot_mm <= ctx.epsilon_mm\n    await sleep 0 if ctx.live_demo\n    µ.DOM.remove slug_dom\n    return { slug_dom, width_mm, overshoot_mm, spc_delta_mm, fitting_ok, }\n\n  #-----------------------------------------------------------------------------------------------------------\n  @get_pointer_metrics = ( ctx ) ->\n    top_mm      = GAUGE.mm_from_px µ.DOM.get_offset_top ctx.reglet_dom\n    advance_mm  = top_mm - ctx.column_top\n    remain_mm   = ctx.column_height_mm - advance_mm\n    return { advance_mm, remain_mm, }\n\n  #-----------------------------------------------------------------------------------------------------------\n  @get_context = ->\n    ### NOTE intermediate solution; later on, the pointer should be set by some higher level method to\n    indicate where upcoming material should be directed to; setting up columns will then consisting of\n    locating the `pointer#pointer` element, then retrieving its parent element (the first column to\n    consider) and the columns that either follow it according to a special 'text flow' attribute or (the\n    default) in document order. ###\n    log '^ops/get_context@66855-1^'\n    R                   = {}\n    R.slug_stencil      = µ.DOM.parse_one await TEMPLATES_slug_as_html()\n    page_dom            = µ.DOM.select 'page'\n    R.columns_dom       = µ.DOM.select_all_from page_dom, 'column'\n    R.columns_idx       = 0\n    column_dom          = R.columns_dom[ R.columns_idx ]\n    R.column_top        = GAUGE.mm_from_px    µ.DOM.get_offset_top column_dom\n    R.column_width_mm   = GAUGE.width_mm_of   column_dom\n    R.column_height_mm  = GAUGE.height_mm_of  column_dom\n    ### TAINT in some cases using innerHTML, documentFragment may be advantageous ###\n    ### TAINT do not use literal name, ID; refer to templates ###\n    R.reglet_dom        = µ.DOM.new_element 'pointer', { id: 'pointer', }\n    # µ.DOM.insert_as_last column_dom, R.reglet_dom\n    µ.DOM.append column_dom, R.reglet_dom\n    R.epsilon_mm        = 0.2\n    R.prv_dom_id        = 0\n    R.caret_dom         = µ.DOM.select '#caret'\n    R.caret_style       = getComputedStyle R.caret_dom\n    #.........................................................................................................\n    R.XXX_insert_big_words = true\n    R.XXX_insert_big_words = false\n    R.live_demo         = false\n    return R\n    ###\n    document.createElement('p')\n    d = document.createElement('p')\n    d.setAttribute('style',\"width:10px;height:10px;border:2px solid red;\")\n    ref = document.getElementById('r1-1')\n    ref.insertAdjacentElement('beforebegin',d)\n    document.getElementById('r1-2').insertAdjacentElement('beforebegin',d)\n    ###\n\n  #-----------------------------------------------------------------------------------------------------------\n  @slugs_with_metrics_from_slabs = ( slabs_dtm, settings ) ->\n    ### TAINT how to use intertype in browser context? ###\n    # validate.interplot_slabs_datom slabs_dtm\n    ### TAINT use intertype for defaults ###\n    log '^ops/slugs_with_metrics_from_slabs@4455-1^'\n    defaults            = { min_slab_idx: 0, }\n    settings            = { defaults..., settings..., }\n    slabs               = slabs_dtm.slabs\n    { min_slab_idx, }   = settings\n    last_slab_idx       = slabs.length - 1\n    max_slab_idx        = min_slab_idx - 1\n    prv_slug_metrics    = null\n    slug_metrics        = null\n    line_nr             = 0\n    R                   = []\n    #.........................................................................................................\n    push_metrics = ( slug_metrics ) =>\n      line_nr++\n      R.push slug_metrics\n      slug_metrics.html = µ.DOM.get_outer_html slug_metrics.slug_dom\n      # ### !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! ###\n      # if ctx.XXX_insert_big_words and ( parts = slug_metrics.slug_jq.text().split /(raised)/ ).length is 3 ### !!!! ###\n      #   # slug_metrics.slug_jq.html \"#{parts[ 0 ]}<span style='font-size:300%'>g#{parts[ 1 ]}y</span>#{parts[ 2 ]}\"\n      #   ### NOTE `<trim/>` needed for proper baseline-alignment ###\n      #   slug_metrics.slug_jq.html \"<trim>#{parts[ 0 ]}<span style='font-size:300%'>g#{parts[ 1 ]}y</span>#{parts[ 2 ]}</trim>\"\n      # ### !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! ###\n      µ.DOM.before ctx.reglet_dom, slug_metrics.slug_dom\n      reglet_metrics    = @get_pointer_metrics ctx\n      log '^33442^', line_nr, \"#{reglet_metrics.advance_mm.toFixed 1} mm / #{reglet_metrics.remain_mm.toFixed 1} mm\"\n      await sleep 0 if ctx.live_demo\n      delete slug_metrics.slug_dom\n      return null\n    #.........................................................................................................\n    ctx           = await @get_context()\n    ctx.live_demo = false\n    ctx.live_demo = true\n    #.........................................................................................................\n    loop\n      max_slab_idx++\n      ### TAINT add prv_slug_metrics to R where missing ###\n      if max_slab_idx > last_slab_idx\n        ### flush ###\n        if prv_slug_metrics?\n          push_metrics prv_slug_metrics\n          prv_slug_metrics  = null\n        break\n      partial_slug  = @_get_partial_slug slabs, min_slab_idx, max_slab_idx\n      slug_metrics  = await @_metrics_from_partial_slug ctx, partial_slug\n      #.......................................................................................................\n      unless slug_metrics.fitting_ok\n        ### flush ###\n        if prv_slug_metrics?\n          min_slab_idx = max_slab_idx # - 1\n          push_metrics prv_slug_metrics\n          prv_slug_metrics  = null\n          continue\n        min_slab_idx = max_slab_idx + 1\n        push_metrics slug_metrics\n        continue\n      #.......................................................................................................\n      prv_slug_metrics = slug_metrics\n    #.........................................................................................................\n    return R\n\n\n############################################################################################################\nprovide_ops.apply globalThis.OPS = {}\n\n\n"
  ]
}